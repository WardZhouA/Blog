{"title":"Nginx站点配置SSL","date":"2020-03-14T13:05:08.000Z","date_formatted":{"ll":"2020年3月14日","L":"2020/03/14","MM-DD":"03-14"},"thumbnail":"https://i.loli.net/2020/03/14/meGnJINsMPjtwfO.png","link":"2020/03/14/nginxSSL","comments":true,"tags":["Nginx","SSL","Web","前端"],"categories":["教程"],"updated":"2020-03-14T13:59:35.914Z","content":"<p>本文接上一篇<a href=\"2020/02/29/nginxServer\">CentOS下使用Nginx+Git部署hexo</a></p>\n<h2 id=\"服务器端\">服务器端<a href=\"#服务器端\" title=\"服务器端\"></a></h2><ol><li><p>在nginx文件夹下新建一个目录用来存放证书</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ <span class=\"built_in\">cd</span> /etc/nginx</span><br><span class=\"line\">$ mkdir cert</span><br></pre></td></tr></table></figure></li>\n<li><p>打开配置文件</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><p>如果你的server节点在引用的文件中，请打开相应文件，如：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ vim /etc/nginx/conf.d/default.conf</span><br></pre></td></tr></table></figure><p>不熟悉vim的基本操作话，请看文章开头的链接</p>\n</li>\n<li><p>在配置文件中新增一个https的 <code>server</code>节点</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">server</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\">    <span class=\"comment\"># 服务器端口使用443，开启ssl, 这里ssl就是上面安装的ssl模块</span></span><br><span class=\"line\">    <span class=\"string\">listen</span>       <span class=\"number\">443</span> <span class=\"string\">ssl;</span></span><br><span class=\"line\">    <span class=\"comment\"># 域名，多个以空格分开</span></span><br><span class=\"line\">    <span class=\"string\">server_name</span>  <span class=\"string\">hack520.com</span> <span class=\"string\">www.hack520.com;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># ssl证书地址</span></span><br><span class=\"line\">    <span class=\"string\">ssl_certificate</span>     <span class=\"string\">/etc/nginx/cert/ssl.pem;</span>  <span class=\"comment\"># pem文件的路径</span></span><br><span class=\"line\">    <span class=\"string\">ssl_certificate_key</span>  <span class=\"string\">/etc/nginx/cert/ssl.key;</span> <span class=\"comment\"># key文件的路径</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\"># ssl验证相关配置</span></span><br><span class=\"line\">    <span class=\"string\">ssl_session_timeout</span>  <span class=\"string\">5m;</span>    <span class=\"comment\">#缓存有效期</span></span><br><span class=\"line\">    <span class=\"string\">ssl_ciphers</span> <span class=\"string\">ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span>    <span class=\"comment\">#加密算法</span></span><br><span class=\"line\">    <span class=\"string\">ssl_protocols</span> <span class=\"string\">TLSv1</span> <span class=\"string\">TLSv1.1</span> <span class=\"string\">TLSv1.2;</span>    <span class=\"comment\">#安全链接可选的加密协议</span></span><br><span class=\"line\">    <span class=\"string\">ssl_prefer_server_ciphers</span> <span class=\"string\">on;</span>   <span class=\"comment\">#使用服务器端的首选算法</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">#location节点，如果是按照上一篇教程的设置，这部分不需修改</span></span><br><span class=\"line\">    <span class=\"string\">location</span> <span class=\"string\">/</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\">        <span class=\"string\">root</span>   <span class=\"string\">html;</span></span><br><span class=\"line\">        <span class=\"string\">index</span>  <span class=\"string\">index.html</span> <span class=\"string\">index.htm;</span></span><br><span class=\"line\">    <span class=\"string\">&#125;</span></span><br></pre></td></tr></table></figure></li>\n<li><p>配置http重定向https</p>\n<p>在配置文件中找到http的<code>server</code>节点，注释掉原有的部分，添加以下配置</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"string\">listen</span> <span class=\"number\">80</span><span class=\"string\">;</span></span><br><span class=\"line\"> <span class=\"string\">server_name</span> <span class=\"string\">localhost;</span>   <span class=\"comment\">#将localhost修改为您证书绑定的域名，例如：www.example.com。</span></span><br><span class=\"line\"><span class=\"string\">rewrite</span> <span class=\"string\">^(.*)$</span> <span class=\"string\">https://$host$1</span> <span class=\"string\">permanent;</span>   <span class=\"comment\">#将所有http请求通过rewrite重定向到https。</span></span><br><span class=\"line\"> <span class=\"string\">location</span> <span class=\"string\">/</span> <span class=\"string\">&#123;</span></span><br><span class=\"line\"><span class=\"string\">index</span> <span class=\"string\">index.html</span> <span class=\"string\">index.htm;</span></span><br></pre></td></tr></table></figure></li>\n<li><p>保存文件并退出</p>\n</li>\n</ol><h2 id=\"客户机端\">客户机端<a href=\"#客户机端\" title=\"客户机端\"></a></h2><ol><li><p>进入服务器的控制台，配置安全组设置，打开用于https的服务器<code>443</code>端口</p>\n</li>\n<li><p>为你的域名申请一个SSL证书，本文使用的是阿里提供的，由赛门铁克签发的免费一年证书。</p>\n</li>\n<li><p>下载证书文件，解压后其中有两个后缀为<code>.pem</code>和<code>.key</code>的文件</p>\n</li>\n<li><p>重命名为<code>ssl.pem</code>和<code>ssl.key</code></p>\n</li>\n<li><p>打开终端使用scp命令上传文件到服务器</p>\n<p>scp语法格式<code>scp local_file remote_username@remote_ip:remote_folder</code></p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ scp local_file/ssl.pem remote_username@remote_ip:/etc/nginx/cert/</span><br><span class=\"line\">$ scp local_file/ssl.key remote_username@remote_ip:/etc/nginx/cert/</span><br><span class=\"line\"><span class=\"comment\"># local_file替换成本地文件的路径</span></span><br><span class=\"line\"><span class=\"comment\"># remote_username替换成服务器的用户名</span></span><br><span class=\"line\"><span class=\"comment\"># remote_ip替换成服务器的IP</span></span><br></pre></td></tr></table></figure></li>\n</ol><h2 id=\"服务器端-1\">服务器端<a href=\"#服务器端-1\" title=\"服务器端\"></a></h2><ol><li><p>测试配置文件是否有问题</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ nginx -t</span><br></pre></td></tr></table></figure><p>出现以下字样说明配置正确，如报错，根据错误修改</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class=\"line\">nginx: configuration file /etc/nginx/nginx.conf <span class=\"built_in\">test</span> is successful</span><br></pre></td></tr></table></figure></li>\n<li><p>重启Nginx</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$ service nginx restart</span><br></pre></td></tr></table></figure></li>\n<li><p>打开浏览器测试</p>\n</li>\n</ol><blockquote>\n<p><strong>参考</strong><br><a href=\"https://www.hack520.com/481.html\" target=\"_blank\">《Nginx 安装 SSL 配置 HTTPS 超详细完整全过程》</a><br><a href=\"https://help.aliyun.com/document_detail/98728.html?spm=5176.2020520154.0.0.425bCcGCCcGCDo\" target=\"_blank\">《在Nginx/Tengine服务器上安装证书》</a><br>封面图片来源 <a href=\"https://kinsta.com/knowledgebase/how-to-install-ssl-certificate/\" target=\"_blank\">kinsta.com</a><br>2020.03.14</p>\n</blockquote>\n","prev":{"title":"Promises第十七章","link":"2020/03/19/PromisesChapter17"},"next":{"title":"Promises第十六章","link":"2020/03/14/PromisesChapter16"},"plink":"http://wardzhou.art/2020/03/14/nginxSSL/","toc":[{"id":"服务器端","title":"服务器端","index":"1"},{"id":"客户机端","title":"客户机端","index":"2"},{"id":"服务器端-1","title":"服务器端","index":"3"}],"reward":true,"copyright":{"author":"白桦树下的人","license":"保持署名-非商用-自由转载-禁止演绎(<a href=\"https://creativecommons.org/licenses/by-nc-nd/4.0/\" rel=\\\"external nofollow\\\" target=\\\"_blank\\\">CC BY-NC-ND 4.0</a>)","updated":"2020年3月14日"}}