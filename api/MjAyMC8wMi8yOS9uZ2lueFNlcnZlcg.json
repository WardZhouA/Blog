{"title":"CentOS下使用Nginx+Git部署hexo","date":"2020-02-29T07:16:37.000Z","date_formatted":{"ll":"2020年2月29日","L":"2020/02/29","MM-DD":"02-29"},"thumbnail":"https://i.loli.net/2020/02/29/az4l93ZMwbC8dXu.jpg","link":"2020/02/29/nginxServer","comments":true,"tags":["Hexo","Nginx","Web","前端"],"categories":["教程"],"updated":"2020-02-29T07:46:54.092Z","content":"<h2 id=\"服务器端\">服务器端<a href=\"#服务器端\" title=\"服务器端\"></a></h2><h3 id=\"安装依赖组件\">安装依赖组件<a href=\"#安装依赖组件\" title=\"安装依赖组件\"></a></h3><p><code>yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel</code></p>\n<p><code>yum install gcc perl-ExtUtils-MakeMaker package</code></p>\n<p><code>yum install git nginx</code></p>\n<h3 id=\"测试nginx\">测试Nginx<a href=\"#测试nginx\" title=\"测试Nginx\"></a></h3><p><strong>启动Nginx</strong></p>\n<p><code>service nginx start</code> </p>\n<p>在浏览器中输入IP测试是否能访问默认页面</p>\n<h3 id=\"创建git仓库\">创建Git仓库<a href=\"#创建git仓库\" title=\"创建Git仓库\"></a></h3><p>创建并修改目录的所有权和用户权限</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir /home/git/</span><br><span class=\"line\">chown -R <span class=\"variable\">$USER</span>:<span class=\"variable\">$USER</span> /home/git/</span><br><span class=\"line\">chmod -R 755 /home/git/</span><br></pre></td></tr></table></figure>\n\n<p>创建git 仓库</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cd</span> /home/git/</span><br><span class=\"line\">git init --bare hexoBlog.git</span><br></pre></td></tr></table></figure>\n\n<p>创建一个新的 git 钩子，用于自动部署</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;home&#x2F;git&#x2F;hexoBlog.git&#x2F;hooks&#x2F;post-receive</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p><strong>Vim 使用</strong><br><code>i:</code>编辑模式<br><code>：</code>命令模式<br><code>Ctrl+C</code>退出编辑模式<br><code>:+w</code>保存文件<br><code>:+q</code>退出Vim</p>\n</blockquote>\n<p>插入以下语句</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#!&#x2F;bin&#x2F;bash</span><br><span class=\"line\">git --work-tree&#x3D;&#x2F;home&#x2F;hexoBlog --git-dir&#x3D;&#x2F;home&#x2F;git&#x2F;hexoBlog.git checkout -f</span><br></pre></td></tr></table></figure>\n\n<p>修改文件权限，使得其可执行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chmod +x &#x2F;home&#x2F;git&#x2F;hexoBlog.git&#x2F;hooks&#x2F;post-receive</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"配置-nginx\">配置 Nginx<a href=\"#配置-nginx\" title=\"配置 Nginx\"></a></h3><p>创建 <code>/home/hexoBlog</code> 目录，用于存放博客静态资源</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mkdir &#x2F;home&#x2F;hexoBlog&#x2F;</span><br><span class=\"line\">chown -R $USER:$USER &#x2F;home&#x2F;hexoBlog&#x2F;</span><br><span class=\"line\">chmod -R 755 &#x2F;home&#x2F;hexoBlog&#x2F;</span><br></pre></td></tr></table></figure>\n\n<p><code>nginx -t</code> 查看 Nginx 配置文件位置</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx: the configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf syntax is ok</span><br><span class=\"line\">nginx: configuration file &#x2F;etc&#x2F;nginx&#x2F;nginx.conf test is successful</span><br></pre></td></tr></table></figure>\n\n<p><code>vim /etc/nginx/nginx.conf</code> 编辑配置文件</p>\n<p>在<code>http</code>下的<code>server</code>节点里编辑<code>root</code>配置，将其中的 root 值改为 <code>/home/hexoBlog</code></p>\n<p>检查配置文件是否准确 <code>nginx -t</code></p>\n<blockquote>\n<p><strong>注：如果这里失败，请注释掉<code>listen 80 default_server;</code>和<code>listen [::]80default_server;</code>这两行，并另起一行添加<code>listen 80;</code></strong></p>\n<p><strong>如果配置文件中不存在server节点，请退出vim，执行以下命令：</strong></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;default.conf</span><br></pre></td></tr></table></figure>\n\n<p>在该文件中做上述修改</p>\n</blockquote>\n<p><code>service nginx restart</code> 重启 Nginx 服务</p>\n<h2 id=\"客户端配置\">客户端配置<a href=\"#客户端配置\" title=\"客户端配置\"></a></h2><p>编辑hexo根目录下配置文件<code>_config.yml</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deploy:</span><br><span class=\"line\">  type: git</span><br><span class=\"line\">  repo: </span><br><span class=\"line\">    随便起名字: root@服务器IP:&#x2F;home&#x2F;git&#x2F;hexoBlog</span><br><span class=\"line\">  branch: master</span><br></pre></td></tr></table></figure>\n\n<p>在目录下运行：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\">hexo d</span><br></pre></td></tr></table></figure>\n\n<p>部署成功后，输入公网IP即可访问你的Hexo站点</p>\n<p>如需停止Nginx在远程ssh输入</p>\n<p><code>nginx -s stop</code></p>\n<blockquote>\n<p>引用参考<a href=\"http://www.allalright.site/post/hexo2\" target=\"_blank\">《部署 Hexo 博客到云服务器》</a></p>\n</blockquote>\n","next":{"title":"Promises第十五章","link":"2020/02/25/PromisesChapter15"},"plink":"http://wardzhou.art/2020/02/29/nginxServer/","toc":[{"id":"服务器端","title":"服务器端","index":"1","children":[{"id":"安装依赖组件","title":"安装依赖组件","index":"1.1"},{"id":"测试nginx","title":"测试Nginx","index":"1.2"},{"id":"创建git仓库","title":"创建Git仓库","index":"1.3"},{"id":"配置-nginx","title":"配置 Nginx","index":"1.4"}]},{"id":"客户端配置","title":"客户端配置","index":"2"}],"reward":true,"copyright":{"author":"白桦树下的人","link":"<a href=\"http://wardzhou.art/2020/02/29/nginxServer/\" title=\"CentOS下使用Nginx+Git部署hexo\">http://wardzhou.art/2020/02/29/nginxServer/</a>","license":"Attribution-NonCommercial-NoDerivatives 4.0 International (<a href=\"https://creativecommons.org/licenses/by-nc-sa/4.0/\" rel=\"external nofollow noopener\" target=\"_blank\">CC BY-NC-ND 4.0</a>)"}}