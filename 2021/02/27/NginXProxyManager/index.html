<!DOCTYPE html><html lang="en"><head><!-- hexo injector head_begin start -->
<script src="/config.2331f3454ba3fd9cd725.js"></script>
<!-- hexo injector head_begin end -->
<meta charset="utf-8">
<title>Nginx Proxy Manager——小而美的多容器转发方案 - 白桦 Birch</title>
<base href="/">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
<link rel="canonical" href="http://wardzhou.art/2021/02/27/NginXProxyManager/">
<link rel="icon" type="image/x-icon" href="/favicon.svg">
<link rel="manifest" href="/manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="description" content="距离上次把博客改用 docker 部署已经过去快半年了，旧的服务器性能有点过剩（ 续不起了 ），所以另购置了台新的云主机，考虑到备案迁移的问题，我还是选择了同一家供应商，免除了再次申请备案信息更改的麻烦。 我之前的主机上跑了三个容器，一个是 Nginx 用来部署博客，然后一个 Trilium 云笔记本再加上一个 Minecraft 服务器。解析的域名都是同一个，分别用不同的端口访问。这真是一点不�">
<meta property="og:type" content="website">
<meta property="og:title" content="Nginx Proxy Manager——小而美的多容器转发方案">
<meta property="og:url" content="http://wardzhou.art/2021/02/27/NginXProxyManager/index.html">
<meta property="og:site_name" content="白桦 Birch">
<meta property="og:description" content="距离上次把博客改用 docker 部署已经过去快半年了，旧的服务器性能有点过剩（ 续不起了 ），所以另购置了台新的云主机，考虑到备案迁移的问题，我还是选择了同一家供应商，免除了再次申请备案信息更改的麻烦。 我之前的主机上跑了三个容器，一个是 Nginx 用来部署博客，然后一个 Trilium 云笔记本再加上一个 Minecraft 服务器。解析的域名都是同一个，分别用不同的端口访问。这真是一点不�">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.wardzhou.art/img/NginXProxyManagerCover.webp">
<meta property="article:published_time" content="2021-02-27T15:57:17.000Z">
<meta property="article:modified_time" content="2021-02-27T16:04:16.886Z">
<meta property="article:author" content="白桦 Birch">
<meta property="article:tag" content="Docker">
<meta property="article:tag" content="Nginx">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.wardzhou.art/img/NginXProxyManagerCover.webp">
<script type="application/ld+json">[{"@context":"http://schema.org","@type":"WebSite","publisher":{"@type":"Person","name":"白桦 Birch","description":"> ","image":"https://wardzhou.art/img/avatar.jpeg"},"url":"http://wardzhou.art","image":"https://wardzhou.art/img/avatar.jpeg","description":"Just a Blog.","author":{"@type":"Person","name":"白桦 Birch","description":"> ","image":"https://wardzhou.art/img/avatar.jpeg"},"inLanguage":{"@type":"Language","alternateName":"en"}},{"@context":"http://schema.org","@type":"Article","articleSection":"教程","url":"http://wardzhou.art/2021/02/27/NginXProxyManager/","headline":"Nginx Proxy Manager——小而美的多容器转发方案","image":"https://cdn.wardzhou.art/img/NginXProxyManagerCover.webp","datePublished":"2021-02-27T15:57:17.000Z","dateModified":"2021-02-27T16:04:16.886Z","keywords":"Docker,Nginx","description":"Just a Blog.","publisher":{"@type":"Organization","name":"白桦 Birch","logo":{"@type":"ImageObject","url":"https://wardzhou.art/img/avatar.jpeg"}},"author":{"@type":"Person","name":"白桦 Birch","description":"> ","image":"https://wardzhou.art/img/avatar.jpeg"},"inLanguage":{"@type":"Language","alternateName":"en"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://wardzhou.art/2021/02/27/NginXProxyManager/"},"thumbnailUrl":"https://cdn.wardzhou.art/img/NginXProxyManagerCover.webp"}]</script><link rel="alternate" type="application/atom+xml" title="白桦 Birch" href="/atom.xml">
<script async="" src="//www.googletagmanager.com/gtag/js?id=G-3P92CH3710"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)};gtag('js',new Date());gtag('config','G-3P92CH3710');</script>
<!-- hexo injector head_end start --><style is="theme">html{--inside-accent-color:#6699CC;--inside-foreground-color:#333333;--inside-border-color:#e0e0e0;--inside-background:#f3f6f7;--inside-sidebar-background:#6699CC linear-gradient(to bottom,#66CCCC 0%,#6699CC 100%);--inside-card-background:#fff;--inside-font-base:'IBM Plex Mono','Noto Sans SC';--inside-font-logo:'Noto Serif SC','IBM Plex Mono','Noto Sans SC';--inside-font-menu:IBM Plex Mono,'IBM Plex Mono','Noto Sans SC';--inside-font-heading:'IBM Plex Mono-SemiBold','Noto Sans SC-Medium','IBM Plex Mono','Noto Sans SC';--inside-font-label:Oxanium,'IBM Plex Mono','Noto Sans SC';--inside-font-code:'IBM Plex Mono','Noto Sans SC';--inside-font-print:-apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;--inside-content-width:660px;--inside-highlight-00:#263238;--inside-highlight-01:#2c393f;--inside-highlight-02:#37474f;--inside-highlight-03:#707880;--inside-highlight-04:#c9ccd3;--inside-highlight-05:#cdd3de;--inside-highlight-06:#d5dbe5;--inside-highlight-07:#ffffff;--inside-highlight-08:#ec5f67;--inside-highlight-09:#ea9560;--inside-highlight-0a:#ffcc00;--inside-highlight-0b:#8bd649;--inside-highlight-0c:#80cbc4;--inside-highlight-0d:#89ddff;--inside-highlight-0e:#82aaff;--inside-highlight-0f:#ec5f67;--inside-card-color:#fff;--inside-accent-color-005:rgba(102,153,204,.05);--inside-accent-color-01:rgba(102,153,204,.1);--inside-accent-color-02:rgba(102,153,204,.2);--inside-accent-color-04:rgba(102,153,204,.4);--inside-accent-color-08:rgba(102,153,204,.8)}</style><link href="//cdn.wardzhou.art/lib/font.css" rel="stylesheet">
<script src="/cipher.d210d59f.js"></script>
<script src="custom/theme2.js"></script><script src="custom/darkmode.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<script> $(document).ready(function() { setTimeout(function() { function myFunction() { if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) { document.getElementsByClassName("x8bd0e")[0].click(); }; document.getElementsByClassName("φa icon-sidebar")[0].click(); }; myFunction(); }, 100); }); </script>
<link href="styles.f658f0eb7bee8606af15.css" rel="stylesheet"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.3.0"><meta name="theme-color" content=""><script type="application/json" is="state">{&q;api/MjAyMS8wMi8yNy9OZ2luWFByb3h5TWFuYWdlcg.json&q;:{&q;title&q;:&q;Nginx Proxy Manager——小而美的多容器转发方案&q;,&q;date&q;:&q;2021-02-27T15:57:17.000Z&q;,&q;date_formatted&q;:{&q;ll&q;:&q;Feb 27, 2021&q;,&q;L&q;:&q;02/27/2021&q;,&q;MM-DD&q;:&q;02-27&q;},&q;author&q;:&q;白桦&q;,&q;thumbnail&q;:&q;https://cdn.wardzhou.art/img/NginXProxyManagerCover.webp&q;,&q;link&q;:&q;2021/02/27/NginXProxyManager&q;,&q;comments&q;:true,&q;tags&q;:[&q;Docker&q;,&q;Nginx&q;],&q;categories&q;:[&q;教程&q;],&q;updated&q;:&q;2021-02-27T16:04:16.886Z&q;,&q;content&q;:&q;&l;p&g;距离上次把博客改用 docker 部署已经过去快半年了，旧的服务器性能有点过剩（ &l;s&g;续不起了&l;/s&g; ），所以另购置了台新的云主机，考虑到备案迁移的问题，我还是选择了同一家供应商，免除了再次申请备案信息更改的麻烦。&l;/p&g;\n&l;p&g;我之前的主机上跑了三个容器，一个是 Nginx 用来部署博客，然后一个 Trilium 云笔记本再加上一个 Minecraft 服务器。解析的域名都是同一个，分别用不同的端口访问。这真是一点不🆒。&l;/p&g;\n&l;p&g;那么有没有办法通过二级域名分别访问指定端口的容器呢？如果还能一键部署 SSL 就更妙了。那么就要请出本篇的主角：&l;a href=\&q;https://nginxproxymanager.com\&q; target=\&q;_blank\&q;&g;Nginx Proxy Manager&l;/a&g;&l;/p&g;\n&l;p&g;Nginx Proxy Manager 实际上就是一个带前端管理界面的 Nginx 服务器，通过Let’s encrypt 来自动申请 SLL 证书并自动部署，反向代理你所需要的容器，甚至是任何目的地，让一个不懂 Nginx 的小白也能轻松配置。&l;/p&g;\n&l;p&g;本篇文章就来简单介绍一下在 Cent 8.3 下如何部署。&l;/p&g;\n&l;h2 id=\&q;1.-配置环境\&q;&g;1. 配置环境&l;a title=\&q;#1.-配置环境\&q; href=\&q;#1.-配置环境\&q;&g;&l;/a&g;&l;/h2&g;\n&l;h3 id=\&q;1.1-安装-docker\&q;&g;1.1 安装 docker&l;a title=\&q;#1.1-安装-docker\&q; href=\&q;#1.1-安装-docker\&q;&g;&l;/a&g;&l;/h3&g;\n&l;figure class=\&q;highlight shell\&q;&g;&l;table&g;&l;tr&g;&l;td class=\&q;gutter\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;1&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;td class=\&q;code\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;sudo dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;/tr&g;&l;/table&g;&l;/figure&g;\n&l;figure class=\&q;highlight shell\&q;&g;&l;table&g;&l;tr&g;&l;td class=\&q;gutter\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;1&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;td class=\&q;code\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;sudo dnf install docker-ce --nobest&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;/tr&g;&l;/table&g;&l;/figure&g;\n&l;h4 id=\&q;配置自动启动\&q;&g;配置自动启动&l;a title=\&q;#配置自动启动\&q; href=\&q;#配置自动启动\&q;&g;&l;/a&g;&l;/h4&g;\n&l;figure class=\&q;highlight shell\&q;&g;&l;table&g;&l;tr&g;&l;td class=\&q;gutter\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;1&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;td class=\&q;code\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;sudo systemctl enable --now docker&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;/tr&g;&l;/table&g;&l;/figure&g;\n&l;h3 id=\&q;1.2-安装-docker-compose\&q;&g;1.2 安装 docker-compose&l;a title=\&q;#1.2-安装-docker-compose\&q; href=\&q;#1.2-安装-docker-compose\&q;&g;&l;/a&g;&l;/h3&g;\n&l;p&g;下载 Docker Compose&l;/p&g;\n&l;figure class=\&q;highlight shell\&q;&g;&l;table&g;&l;tr&g;&l;td class=\&q;gutter\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;1&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;td class=\&q;code\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;sudo curl -L &a;quot;https://github.com/docker/compose/releases/download/1.27.4/docker-compose-$(uname -s)-$(uname -m)&a;quot; -o /usr/local/bin/docker-compose&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;/tr&g;&l;/table&g;&l;/figure&g;\n&l;p&g;修改文件的权限&l;/p&g;\n&l;figure class=\&q;highlight shell\&q;&g;&l;table&g;&l;tr&g;&l;td class=\&q;gutter\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;1&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;td class=\&q;code\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;sudo chmod +x /usr/local/bin/docker-compose&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;/tr&g;&l;/table&g;&l;/figure&g;\n&l;h3 id=\&q;1.3-更改镜像源\&q;&g;1.3 更改镜像源&l;a title=\&q;#1.3-更改镜像源\&q; href=\&q;#1.3-更改镜像源\&q;&g;&l;/a&g;&l;/h3&g;\n&l;p&g;内地访问 Docker Hub 的速度慢得可怕，所以我建议可以选择用国内的镜像源替代。如果你用的是阿里的服务，那么可以在控制台申请一个 docker 加速的网址，替换到文件里即可。下面的代码中用的是网易和百度的源。&l;/p&g;\n&l;figure class=\&q;highlight shell\&q;&g;&l;table&g;&l;tr&g;&l;td class=\&q;gutter\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;1&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;2&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;3&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;4&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;5&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;6&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;7&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;8&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;9&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;10&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;11&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;td class=\&q;code\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;sudo mkdir -p /etc/docker&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;sudo tee /etc/docker/daemon.json &a;lt;&a;lt;-&a;#x27;EOF&a;#x27;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&a;#123;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;  &a;quot;registry-mirrors&a;quot;: [&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &a;quot;https://hub-mirror.c.163.com&a;quot;,&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &a;quot;https://mirror.baidubce.com&a;quot;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;  ]&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&a;#125;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;EOF&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;sudo systemctl daemon-reload&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;sudo systemctl restart docker&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;/tr&g;&l;/table&g;&l;/figure&g;\n&l;h2 id=\&q;2.-编写-docker-compose.xml\&q;&g;2. 编写 Docker Compose.xml&l;a title=\&q;#2.-编写-docker-compose.xml\&q; href=\&q;#2.-编写-docker-compose.xml\&q;&g;&l;/a&g;&l;/h2&g;\n&l;p&g;先在任意位置创建一个文件夹，然后创建 &l;code&g;docker-compose.yml&l;/code&g; 文件，用于部署容器。&l;/p&g;\n&l;figure class=\&q;highlight shell\&q;&g;&l;table&g;&l;tr&g;&l;td class=\&q;gutter\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;1&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;2&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;3&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;4&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;td class=\&q;code\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;cd /home/&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;mkdir myapp&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;cd myapp&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;vim docker-compose.yml&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;/tr&g;&l;/table&g;&l;/figure&g;\n&l;p&g;在 vim 中 &l;code&g;:i&l;/code&g; 把写好的文配置直接粘贴进去，esc 退出插入模式，&l;code&g;:w&l;/code&g; 保存文件然后运行 &l;code&g;:q&l;/code&g; 退出编辑器。&l;/p&g;\n&l;p&g;下面是我的配置文件。&l;/p&g;\n&l;figure class=\&q;highlight yml\&q;&g;&l;figcaption&g;&l;span&g;docker-compose.yml&l;/span&g;&l;/figcaption&g;&l;table&g;&l;tr&g;&l;td class=\&q;gutter\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;1&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;2&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;3&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;4&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;5&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;6&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;7&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;8&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;9&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;10&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;11&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;12&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;13&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;14&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;15&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;16&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;17&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;18&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;19&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;20&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;21&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;22&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;23&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;24&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;25&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;26&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;27&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;28&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;29&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;30&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;31&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;32&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;33&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;34&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;35&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;36&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;37&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;38&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;39&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;40&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;41&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;42&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;43&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;44&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;45&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;td class=\&q;code\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;attr\&q;&g;version:&l;/span&g; &l;span class=\&q;string\&q;&g;&a;quot;3.7&a;quot;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;span class=\&q;attr\&q;&g;services:&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;  &l;span class=\&q;attr\&q;&g;app:&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;image:&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;jc21/nginx-proxy-manager:latest&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;restart:&l;/span&g; &l;span class=\&q;string\&q;&g;always&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;ports:&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;comment\&q;&g;# Public HTTP Port:&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;bullet\&q;&g;-&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;80:80&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;comment\&q;&g;# Public HTTPS Port:&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;bullet\&q;&g;-&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;443:443&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;comment\&q;&g;# Admin Web Port:&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;bullet\&q;&g;-&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;81:81&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;environment:&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;attr\&q;&g;DB_SQLITE_FILE:&l;/span&g; &l;span class=\&q;string\&q;&g;&a;quot;/data/database.sqlite&a;quot;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;volumes:&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;bullet\&q;&g;-&l;/span&g; &l;span class=\&q;string\&q;&g;./data:/data&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;bullet\&q;&g;-&l;/span&g; &l;span class=\&q;string\&q;&g;./letsencrypt:/etc/letsencrypt&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;  &l;span class=\&q;attr\&q;&g;nginx:&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;image:&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;nginx&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;restart:&l;/span&g; &l;span class=\&q;string\&q;&g;always&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;ports:&l;/span&g; &l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;bullet\&q;&g;-&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;4007:80&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;volumes:&l;/span&g; &l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;bullet\&q;&g;-&l;/span&g; &l;span class=\&q;string\&q;&g;/home/hexoBlog:/usr/share/nginx/html&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;  &l;span class=\&q;attr\&q;&g;note:&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;image:&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;zadam/trilium:latest&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;restart:&l;/span&g; &l;span class=\&q;string\&q;&g;always&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;ports:&l;/span&g; &l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;bullet\&q;&g;-&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;4005:8080&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;volumes:&l;/span&g; &l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;bullet\&q;&g;-&l;/span&g; &l;span class=\&q;string\&q;&g;/home/trilium-data:/root/trilium-data&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;  &l;span class=\&q;attr\&q;&g;mc:&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;image:&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;itzg/minecraft-server&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;restart:&l;/span&g; &l;span class=\&q;string\&q;&g;always&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;environment:&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;attr\&q;&g;EULA:&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;TRUE&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;attr\&q;&g;ENABLE_AUTOPAUSE:&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;TRUE&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;attr\&q;&g;MODE:&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;survival&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;attr\&q;&g;LEVEL:&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;AfterWorld&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;ports:&l;/span&g; &l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;bullet\&q;&g;-&l;/span&g; &l;span class=\&q;string\&q;&g;&a;#x27;4008:25565&a;#x27;&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;    &l;span class=\&q;attr\&q;&g;volumes:&l;/span&g; &l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;      &l;span class=\&q;bullet\&q;&g;-&l;/span&g; &l;span class=\&q;string\&q;&g;/home/minecraft:/data&l;/span&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;/tr&g;&l;/table&g;&l;/figure&g;\n&l;p&g;在文件夹下继续运行 &l;code&g;docker-compose up -d&l;/code&g; 即可部署。&l;/p&g;\n&l;p&g;部署完毕后，你就可以通过 &l;code&g;docker container ls&l;/code&g; 查看容器的运行情况。&l;/p&g;\n&l;p&g;到这里，工作已经运行大半，接下来我们就要配置域名解析和转发。&l;/p&g;\n&l;h2 id=\&q;3.-配置域名\&q;&g;3. 配置域名&l;a title=\&q;#3.-配置域名\&q; href=\&q;#3.-配置域名\&q;&g;&l;/a&g;&l;/h2&g;\n&l;p&g;首先你需要去服务器安全组配置中，把 &l;code&g;81&l;/code&g; 端口开放。然后转到你的域名提供商控制台，把需要解析的域名全部指向你的服务器 &l;code&g;IP&l;/code&g;。然后通过域名或者 IP:81 在浏览器直接登陆 Nginx Proxy Manager 的前端界面。&l;/p&g;\n&l;p&g;注意，默认的登陆邮箱和密码是：&l;/p&g;\n&l;figure class=\&q;highlight plain\&q;&g;&l;table&g;&l;tr&g;&l;td class=\&q;gutter\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;1&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;2&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;td class=\&q;code\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;admin@example.com&l;/span&g;&l;br&g;&l;span class=\&q;line\&q;&g;changeme&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;/tr&g;&l;/table&g;&l;/figure&g;\n&l;p&g;登陆成功后，系统会要求你修改新的密码。完成后，就可以开始配置了。&l;/p&g;\n&l;p&g;&l;img src=\&q;https://cdn.wardzhou.art/img/NginXProxyManagerConsole.webp\&q; alt=\&q;\&q; class=\&q;φbs\&q;&g;&l;/p&g;\n&l;p&g;点击 New Proxy Host 创建一个代理规则，在 Domin Names 中填写一个或多个你想要用来访问该容器的域名。&l;/p&g;\n&l;p&g;如果你没有特殊配置 https ，这里使用默认的 http 第二栏的 Forward Hostname / IP 处，填写容器所在 Docker 网桥的虚拟 IP，这个 IP 可以通过下面的命令查到。&l;/p&g;\n&l;figure class=\&q;highlight plain\&q;&g;&l;table&g;&l;tr&g;&l;td class=\&q;gutter\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;1&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;td class=\&q;code\&q;&g;&l;pre&g;&l;span class=\&q;line\&q;&g;docker network inspect bridge&l;/span&g;&l;br&g;&l;/pre&g;&l;/td&g;&l;/tr&g;&l;/table&g;&l;/figure&g;\n&l;p&g;在结果中，找到 &l;code&g;IPAM-Config-Gateway&l;/code&g; 节点，后面的 IP 就是我们所需要的。&l;/p&g;\n&l;blockquote&g;\n&l;p&g;如果你在 &l;code&g;docker-compose.yml&l;/code&g; 自定义了一个网桥，那么请用你自定义的网桥名称替换掉上面命令中的 &l;code&g;bridge&l;/code&g; 参数。&l;/p&g;\n&l;/blockquote&g;\n&l;p&g;而端口，则是你最开始配置中对应容器&l;strong&g;暴漏&l;/strong&g;在外面的端口。&l;/p&g;\n&l;p&g;如果你不需要为网站配置 SSL 的话到这里，点击 Save 就可以了。否则，请点击 SSL 选项卡，证书一栏选择申请一个新的 SSL 证书，填写邮件地址，同意协议即可。如果需要强制 https 访问，请打开 Force SSL 选项。最后点 Save 就可以了。&l;/p&g;\n&l;p&g;其余的容器的配置也都是一样的。&l;/p&g;\n&l;p&g;最后，你可能注意到了，这个前端页面并不安全，我们需要给他自己也套个代理（&l;s&g;套娃警告&l;/s&g;）。&l;/p&g;\n&l;p&g;配置同刚刚的例子差不多，端口号改为 &l;code&g;81&l;/code&g; 即可。&l;/p&g;\n&l;p&g;用域名测试，能够正常访问的话，就可以在安全组关掉 &l;code&g;81&l;/code&g; 端口的访问了。&l;/p&g;\n&l;p&g;到这里就大功告成咯～&l;/p&g;\n&l;p&g;完整的文档你可以在 &l;a href=\&q;https://nginxproxymanager.com\&q; target=\&q;_blank\&q;&g;Nginx Proxy Manager&l;/a&g; 的官网找到，另外还有一个 Youtube 博主做的&l;a href=\&q;https://www.youtube.com/watch?v=RBVcnxTiIL0&a;amp;t=1731s\&q; target=\&q;_blank\&q;&g;视频&l;/a&g;，希望能对你有所帮助。&l;/p&g;\n&l;hr&g;\n&l;h4 id=\&q;参考\&q;&g;参考&l;a title=\&q;#参考\&q; href=\&q;#参考\&q;&g;&l;/a&g;&l;/h4&g;\n&l;p&g;[1] &l;a href=\&q;https://blog.csdn.net/qq_36380748/article/details/111560682\&q; target=\&q;_blank\&q;&g;写代码的厨师, 2020.Docker Compose的安装和使用.CSDN&l;/a&g;&l;br&g;\n[2] &l;a href=\&q;https://cloud.tencent.com/developer/article/1626829\&q; target=\&q;_blank\&q;&g;雪梦科技, 2020.如何在 RHEL 8 / CentOS 8上安装 Docker CE.腾讯云社区&l;/a&g;&l;/p&g;\n&q;,&q;prev&q;:{&q;title&q;:&q;西风&q;,&q;link&q;:&q;2021/03/02/WestWind&q;},&q;next&q;:{&q;title&q;:&q;无风的夜&q;,&q;link&q;:&q;2021/02/15/WindlessNight&q;},&q;plink&q;:&q;http://wardzhou.art/2021/02/27/NginXProxyManager/&q;,&q;toc&q;:[{&q;id&q;:&q;1.-配置环境&q;,&q;title&q;:&q;1. 配置环境&q;,&q;index&q;:&q;1&q;,&q;children&q;:[{&q;id&q;:&q;1.1-安装-docker&q;,&q;title&q;:&q;1.1 安装 docker&q;,&q;index&q;:&q;1.1&q;},{&q;id&q;:&q;1.2-安装-docker-compose&q;,&q;title&q;:&q;1.2 安装 docker-compose&q;,&q;index&q;:&q;1.2&q;},{&q;id&q;:&q;1.3-更改镜像源&q;,&q;title&q;:&q;1.3 更改镜像源&q;,&q;index&q;:&q;1.3&q;}]},{&q;id&q;:&q;2.-编写-docker-compose.xml&q;,&q;title&q;:&q;2. 编写 Docker Compose.xml&q;,&q;index&q;:&q;2&q;},{&q;id&q;:&q;3.-配置域名&q;,&q;title&q;:&q;3. 配置域名&q;,&q;index&q;:&q;3&q;}],&q;reward&q;:true,&q;copyright&q;:{&q;author&q;:&q;白桦&q;,&q;license&q;:&q;Attribution-NonCommercial-NoDerivatives 4.0 International(&l;a href=\&q;https://creativecommons.org/licenses/by-nc-nd/4.0/\&q; rel=\\\&q;external nofollow\\\&q; target=\\\&q;_blank\\\&q;&g;CC BY-NC-ND 4.0&l;/a&g;)&q;,&q;updated&q;:&q;February 28, 2021&q;},&q;reading_time&q;:&q;1429 words in 10 min&q;}}</script></head>
<body lang="en"><!-- hexo injector body_begin start --><is-a class="φh" ng-version="11.0.2"><is-l class="φcx"><div class="φdh"><section class="φdi"><header class="φcy"><!----><is-c class="φcz"><img draggable="false" class="φr" src="https://wardzhou.art/img/avatar.jpeg" alt="" title="" width="160" height="160"></is-c><!----><a href="" class="φdb">白桦 Birch</a><p class="φda">&gt; </p></header><div class="φdm"><a routerlink="/archives" class="φdn" href="/archives"><span>103</span><span>Archives</span></a><a class="φdn" href="/categories/Academic"><span>14</span><span>Categories</span></a><!----><a routerlink="/tags" class="φdn" href="/tags"><span>59</span><span>Tags</span></a><!----></div><!----><nav class="φdj"><a class="φdk" href="/">🏠 Home</a><!----><!----><!----><a class="φdk" href="/context">📰 Works</a><!----><!----><!----><a class="φdk" href="/search">🔍 Search</a><!----><!----><!----><a class="φdk" href="/resource">🧭 Resource</a><!----><!----><!----><a class="φdk" href="/about">🌈 About</a><!----><!----><!----><!----></nav><!----><div issnippet="" class="φb"></div><div issnippet="" class="φb"><is-darkmode block=""></is-darkmode></div><!----><!----><!----></section><footer class="φdc φdd"><div class="φdf"><!----><a target="_blank" rel="external nofollow noopener" class="φdg" title="Github" href="https://github.com/derbirch"><i class="icon-github"></i></a><!----><!----><!----><a target="_blank" rel="external nofollow noopener" class="φdg" title="Instagram" href="https://www.instagram.com/nanyuzhou/"><i class="icon-instagram"></i></a><!----><!----><!----><a target="_blank" rel="external nofollow noopener" class="φdg" title="Email" href="mailto:wardzhou@outlook.com"><i class="icon-email"></i></a><!----><!----><!----><a target="_blank" rel="external nofollow noopener" class="φdg" title="AO3" href="https://archiveofourown.org/users/orangeShirt"><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>Archive of Our Own icon</title><path d="M18.417 9.883c-.687 1.116-1.823 1.722-2.99 1.855-4.227.484-6.047-4.149-3.469-6.728 2.31-2.31 7.082-.9 7.005 2.899-.011.611-.166 1.357-.546 1.974zm-6.459-2.029c.142 3.596 4.764 3.682 5.687 1.054.815-2.324-1.12-4.199-3.19-3.897-1.523.221-2.553 1.411-2.497 2.843z"></path><path d="M23.123 6.003c.284-.131.697-.412.837-.246.211.251-.459.475-.748.664-.918.6-1.731 1.227-2.477 2.049-.959 1.059-1.944 2.376-2.55 3.818.618.032 3.021.157 3.6 1.481.464 1.062-.387 2.156-1.32 2.627.663.414 1.81.945 1.745 1.898-.158 2.343-3.696 2.241-5.178.695-.244-.289-.358-.482-.25-.578.151-.134.326.186.676.476.225.187.377.251.572.354 1.301.683 3.339.403 3.478-.792.064-.554-.664-.955-1.217-1.204-.498-.224-1.514-.386-1.494-.952.02-.554.524-.45 1.03-.65.55-.217 1.004-.901 1.003-1.116-.005-.905-2.062-.888-3.221-.92-.275.606-.471 1.226-.692 2.158-.139.583-.151 1.897-.748 2.029-.737.164-1.014-.477-1.455-.991-.594-.69-1.436-1.637-1.942-2.223-3.033 1.002-5.392 2.091-8.256 3.712-1.311.742-2.063 1.59-2.545 1.354-.396-.194-.339-.633-.147-.887.393-.521.927-1.225 1.396-1.888.6-.849 1.054-1.667 1.373-2.445.692-1.688 1.23-4.72 1.475-5.859.088-.412.309-.348.322-.148.027.419-.237 2.047-.29 2.383-.436 2.781-.772 4.41-2.009 6.349 2.196-1.358 4.805-3.019 7.592-3.955C8.846 9.936 5.847 6.85 1.676 4.905 1.037 4.542 0 4.464 0 4.22c0-.271.781-.06 1.043.007 2.383.596 4.817 2.141 6.601 3.444 2.145 1.567 4.714 3.967 5.679 5.081.657-.226 2.286-.457 3.696-.496.752-1.58 2.55-4.018 4.788-5.442.413-.263.842-.594 1.316-.811zm-8.594 8.071c.423.428.742.934 1.11 1.398.174-.59.405-1.216.643-1.758-.619.082-1.281.203-1.753.36z"></path></svg>
</a><!----><!----><!----><a target="_blank" rel="external nofollow noopener" class="φdg" title="Behance" href="https://www.behance.net/wardzhou/"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M22 7h-7v-2h7v2zm1.726 10c-.442 1.297-2.029 3-5.101 3-3.074 0-5.564-1.729-5.564-5.675 0-3.91 2.325-5.92 5.466-5.92 3.082 0 4.964 1.782 5.375 4.426.078.506.109 1.188.095 2.14h-8.027c.13 3.211 3.483 3.312 4.588 2.029h3.168zm-7.686-4h4.965c-.105-1.547-1.136-2.219-2.477-2.219-1.466 0-2.277.768-2.488 2.219zm-9.574 6.988h-6.466v-14.967h6.953c5.476.081 5.58 5.444 2.72 6.906 3.461 1.26 3.577 8.061-3.207 8.061zm-3.466-8.988h3.584c2.508 0 2.906-3-.312-3h-3.272v3zm3.391 3h-3.391v3.016h3.341c3.055 0 2.868-3.016.05-3.016z"></path></svg>
</a><!----><!----><!----></div><!----><p class="φe">© 2021 🧳 WardZhou</p><!----><!----><p class="φe"><span id="busuanzi_container_site_uv" style="display:none">Total <span id="busuanzi_value_site_uv"></span> visitors. </span><span id="busuanzi_container_site_pv" style="display:none"><span id="busuanzi_value_site_pv"></span> Views.</span><br><a href="http://beian.miit.gov.cn/" target="_Blank">辽ICP备20002645号</a></p><!----></footer></div></is-l><div class="φj"><div class="φi"><div class="φn"><main class="φm"><router-outlet></router-outlet><is-s class="φeu"><header class="φfe φfo" style="background-image:url(https://cdn.wardzhou.art/img/NginXProxyManagerCover.webp);background-color:;"><div class="φfn"><!----><p class="φfg"><span class="φfh φfl">Feb 27, 2021</span><a class="φfh φfj" href="/categories/%E6%95%99%E7%A8%8B">教程</a><!----><span class="φfh φfk">1429 words in 10 min</span><!----><!----></p><hr class="φfp"><!----><h1 class="φfq">Nginx Proxy Manager——小而美的多容器转发方案</h1><!----></div></header><article itemscope="" itemtype="http://schema.org/Article" class="φex" data-title="Nginx Proxy Manager——小而美的多容器转发方案"><div itemprop="articleBody" issnippet="" iszoomable="" class="φe"><p>距离上次把博客改用 docker 部署已经过去快半年了，旧的服务器性能有点过剩（ <s>续不起了</s> ），所以另购置了台新的云主机，考虑到备案迁移的问题，我还是选择了同一家供应商，免除了再次申请备案信息更改的麻烦。</p>
<p>我之前的主机上跑了三个容器，一个是 Nginx 用来部署博客，然后一个 Trilium 云笔记本再加上一个 Minecraft 服务器。解析的域名都是同一个，分别用不同的端口访问。这真是一点不🆒。</p>
<p>那么有没有办法通过二级域名分别访问指定端口的容器呢？如果还能一键部署 SSL 就更妙了。那么就要请出本篇的主角：<a href="https://nginxproxymanager.com" target="_blank">Nginx Proxy Manager</a></p>
<p>Nginx Proxy Manager 实际上就是一个带前端管理界面的 Nginx 服务器，通过Let’s encrypt 来自动申请 SLL 证书并自动部署，反向代理你所需要的容器，甚至是任何目的地，让一个不懂 Nginx 的小白也能轻松配置。</p>
<p>本篇文章就来简单介绍一下在 Cent 8.3 下如何部署。</p>
<h2 id="1.-配置环境">1. 配置环境<a title="#1.-配置环境" href="#1.-配置环境"></a></h2>
<h3 id="1.1-安装-docker">1.1 安装 docker<a title="#1.1-安装-docker" href="#1.1-安装-docker"></a></h3>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dnf install docker-ce --nobest</span><br></pre></td></tr></tbody></table></figure>
<h4 id="配置自动启动">配置自动启动<a title="#配置自动启动" href="#配置自动启动"></a></h4>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl enable --now docker</span><br></pre></td></tr></tbody></table></figure>
<h3 id="1.2-安装-docker-compose">1.2 安装 docker-compose<a title="#1.2-安装-docker-compose" href="#1.2-安装-docker-compose"></a></h3>
<p>下载 Docker Compose</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L "https://github.com/docker/compose/releases/download/1.27.4/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose</span><br></pre></td></tr></tbody></table></figure>
<p>修改文件的权限</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></tbody></table></figure>
<h3 id="1.3-更改镜像源">1.3 更改镜像源<a title="#1.3-更改镜像源" href="#1.3-更改镜像源"></a></h3>
<p>内地访问 Docker Hub 的速度慢得可怕，所以我建议可以选择用国内的镜像源替代。如果你用的是阿里的服务，那么可以在控制台申请一个 docker 加速的网址，替换到文件里即可。下面的代码中用的是网易和百度的源。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'</span><br><span class="line">{</span><br><span class="line">  "registry-mirrors": [</span><br><span class="line">    "https://hub-mirror.c.163.com",</span><br><span class="line">    "https://mirror.baidubce.com"</span><br><span class="line">  ]</span><br><span class="line">}</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></tbody></table></figure>
<h2 id="2.-编写-docker-compose.xml">2. 编写 Docker Compose.xml<a title="#2.-编写-docker-compose.xml" href="#2.-编写-docker-compose.xml"></a></h2>
<p>先在任意位置创建一个文件夹，然后创建 <code>docker-compose.yml</code> 文件，用于部署容器。</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /home/</span><br><span class="line">mkdir myapp</span><br><span class="line">cd myapp</span><br><span class="line">vim docker-compose.yml</span><br></pre></td></tr></tbody></table></figure>
<p>在 vim 中 <code>:i</code> 把写好的文配置直接粘贴进去，esc 退出插入模式，<code>:w</code> 保存文件然后运行 <code>:q</code> 退出编辑器。</p>
<p>下面是我的配置文件。</p>
<figure class="highlight yml"><figcaption><span>docker-compose.yml</span></figcaption><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.7"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">'jc21/nginx-proxy-manager:latest'</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="comment"># Public HTTP Port:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'80:80'</span></span><br><span class="line">      <span class="comment"># Public HTTPS Port:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'443:443'</span></span><br><span class="line">      <span class="comment"># Admin Web Port:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">'81:81'</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">DB_SQLITE_FILE:</span> <span class="string">"/data/database.sqlite"</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./letsencrypt:/etc/letsencrypt</span></span><br><span class="line">  <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">'nginx'</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">'4007:80'</span></span><br><span class="line">    <span class="attr">volumes:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/hexoBlog:/usr/share/nginx/html</span></span><br><span class="line">  <span class="attr">note:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">'zadam/trilium:latest'</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">ports:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">'4005:8080'</span></span><br><span class="line">    <span class="attr">volumes:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/trilium-data:/root/trilium-data</span></span><br><span class="line">  <span class="attr">mc:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">'itzg/minecraft-server'</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">EULA:</span> <span class="string">'TRUE'</span></span><br><span class="line">      <span class="attr">ENABLE_AUTOPAUSE:</span> <span class="string">'TRUE'</span></span><br><span class="line">      <span class="attr">MODE:</span> <span class="string">'survival'</span></span><br><span class="line">      <span class="attr">LEVEL:</span> <span class="string">'AfterWorld'</span></span><br><span class="line">    <span class="attr">ports:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">'4008:25565'</span></span><br><span class="line">    <span class="attr">volumes:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/minecraft:/data</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<p>在文件夹下继续运行 <code>docker-compose up -d</code> 即可部署。</p>
<p>部署完毕后，你就可以通过 <code>docker container ls</code> 查看容器的运行情况。</p>
<p>到这里，工作已经运行大半，接下来我们就要配置域名解析和转发。</p>
<h2 id="3.-配置域名">3. 配置域名<a title="#3.-配置域名" href="#3.-配置域名"></a></h2>
<p>首先你需要去服务器安全组配置中，把 <code>81</code> 端口开放。然后转到你的域名提供商控制台，把需要解析的域名全部指向你的服务器 <code>IP</code>。然后通过域名或者 IP:81 在浏览器直接登陆 Nginx Proxy Manager 的前端界面。</p>
<p>注意，默认的登陆邮箱和密码是：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin@example.com</span><br><span class="line">changeme</span><br></pre></td></tr></tbody></table></figure>
<p>登陆成功后，系统会要求你修改新的密码。完成后，就可以开始配置了。</p>
<p><img src="https://cdn.wardzhou.art/img/NginXProxyManagerConsole.webp" alt="" class="φbs"></p>
<p>点击 New Proxy Host 创建一个代理规则，在 Domin Names 中填写一个或多个你想要用来访问该容器的域名。</p>
<p>如果你没有特殊配置 https ，这里使用默认的 http 第二栏的 Forward Hostname / IP 处，填写容器所在 Docker 网桥的虚拟 IP，这个 IP 可以通过下面的命令查到。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect bridge</span><br></pre></td></tr></tbody></table></figure>
<p>在结果中，找到 <code>IPAM-Config-Gateway</code> 节点，后面的 IP 就是我们所需要的。</p>
<blockquote>
<p>如果你在 <code>docker-compose.yml</code> 自定义了一个网桥，那么请用你自定义的网桥名称替换掉上面命令中的 <code>bridge</code> 参数。</p>
</blockquote>
<p>而端口，则是你最开始配置中对应容器<strong>暴漏</strong>在外面的端口。</p>
<p>如果你不需要为网站配置 SSL 的话到这里，点击 Save 就可以了。否则，请点击 SSL 选项卡，证书一栏选择申请一个新的 SSL 证书，填写邮件地址，同意协议即可。如果需要强制 https 访问，请打开 Force SSL 选项。最后点 Save 就可以了。</p>
<p>其余的容器的配置也都是一样的。</p>
<p>最后，你可能注意到了，这个前端页面并不安全，我们需要给他自己也套个代理（<s>套娃警告</s>）。</p>
<p>配置同刚刚的例子差不多，端口号改为 <code>81</code> 即可。</p>
<p>用域名测试，能够正常访问的话，就可以在安全组关掉 <code>81</code> 端口的访问了。</p>
<p>到这里就大功告成咯～</p>
<p>完整的文档你可以在 <a href="https://nginxproxymanager.com" target="_blank">Nginx Proxy Manager</a> 的官网找到，另外还有一个 Youtube 博主做的<a href="https://www.youtube.com/watch?v=RBVcnxTiIL0&amp;t=1731s" target="_blank">视频</a>，希望能对你有所帮助。</p>
<hr>
<h4 id="参考">参考<a title="#参考" href="#参考"></a></h4>
<p>[1] <a href="https://blog.csdn.net/qq_36380748/article/details/111560682" target="_blank">写代码的厨师, 2020.Docker Compose的安装和使用.CSDN</a><br>
[2] <a href="https://cloud.tencent.com/developer/article/1626829" target="_blank">雪梦科技, 2020.如何在 RHEL 8 / CentOS 8上安装 Docker CE.腾讯云社区</a></p>
</div><is-f class="φx"><!----><ul class="φbb"><li class="φz"><strong class="φba">Author<span>:</span></strong><p class="φy">白桦</p></li><li class="φz"><strong class="φba">Copyright<span>:</span></strong><p class="φy">Attribution-NonCommercial-NoDerivatives 4.0 International(<a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" rel="\&quot;external" target="\&quot;_blank\&quot;">CC BY-NC-ND 4.0</a>)</p></li><li class="φz"><strong class="φba">Updated<span>:</span></strong><p class="φy">February 28, 2021</p></li><!----></ul><!----></is-f><!----><is-k class="φcp"><p class="φcu">Buy me snacks 🍩.</p><div class="φcr"><div class="φcw"><a class="φcv φa icon-wechat" style="color:;"></a><a class="φcv φa icon-paypal" style="color:;"></a><a class="φcv" style="color:;">支</a><!----></div><div class="φct"><!----></div></div></is-k><!----><div><div issnippet="" class="φb"><link href="custom/font-awesome/css/font-awesome.min.css" rel="stylesheet"><link href="custom/clipboard.css" rel="stylesheet"></div><div issnippet="" class="φb"></div><!----></div><!----></article><footer class="φey"><div class="φfd"><is-m class="φdp"><a class="φdq" href="/tags/Docker">Docker</a></is-m><is-m class="φdp"><a class="φdq" href="/tags/Nginx">Nginx</a></is-m><!----></div><!----><div class="φez"><a class="φfa φfc" href="/2021/03/02/WestWind">西风</a><!----><a class="φfa φfb" href="/2021/02/15/WindlessNight">无风的夜</a><!----></div><!----></footer><is-e class="φu"><div issnippet="" class="φb"><a class="φv" id="loadcom" onclick="loadvaline(); return false;"><span>加载评论💬<br>Load Comments</span></a><div id="vcomment"></div></div><!----><!----><!----><!----></is-e><!----><!----><!----></is-s><!----></main><!----></div></div></div><is-g class="φbc"><div class="φbl"><span class="φa icon-up"></span><span class="φa icon-down"></span><!----><span class="φa icon-toc"></span><!----><span class="φa icon-search"></span><!----></div><div class="φbe φbf"><svg class="φbk"><defs><filter id="dp"><feGaussianBlur in="SourceGraphic" stdDeviation="2"></feGaussianBlur></filter></defs><circle filter="url(#dp)" fill="rgba(0,0,0,.3)" cx="50%" cy="52%" r="44%"></circle><circle cx="50%" cy="50%" r="44%" class="φbg"></circle><circle cx="50%" cy="50%" r="48%" class="φbj" stroke-dasharray="0% 314.15926%"></circle><!----><g class="φbh"><circle r=".2rem" cx="0" cy="-.8rem"></circle><circle r=".2rem"></circle><circle r=".2rem" cx="0" cy=".8rem"></circle></g><!----></svg></div></is-g><is-n class="φdr"><div class="φdt φdu"><a class="φdw"><span class="φdy">1 </span><!----><span class="φdz">1. 配置环境</span></a><div class="φdt"><a class="φdw"><span class="φdy">1.1 </span><!----><span class="φdz">1.1 安装 docker</span></a><!----></div><div class="φdt"><a class="φdw"><span class="φdy">1.2 </span><!----><span class="φdz">1.2 安装 docker-compose</span></a><!----></div><div class="φdt"><a class="φdw"><span class="φdy">1.3 </span><!----><span class="φdz">1.3 更改镜像源</span></a><!----></div><!----><!----><!----></div><div class="φdt φdu"><a class="φdw"><span class="φdy">2 </span><!----><span class="φdz">2. 编写 Docker Compose.xml</span></a><!----></div><div class="φdt φdu"><a class="φdw"><span class="φdy">3 </span><!----><span class="φdz">3. 配置域名</span></a><!----></div><!----></is-n><!----><!----></is-a><!-- hexo injector body_begin end --><!-- hexo injector body_end start --><script src="runtime.1627035ae7607fe619b2.js"></script><script src="polyfills.67bd14d004c90208818f.js"></script><script src="main.b1cf8c9d66e2ceb74cfb.js"></script><!-- hexo injector body_end end -->

</body></html>